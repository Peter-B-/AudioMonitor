using System.Dynamic;
using System.Windows.Media;
using AudioMonitor.Interfaces;

namespace AudioMonitor
{
    public class ColorPaletteViridis : IColorPalette
    {
        private readonly float min;
        private readonly float max;

        // Based on https://github.com/BIDS/colormap/blob/master/option_d.py
        private static readonly Color[] Colors = new[]
        {
            Color.FromRgb(68, 1, 84),
            Color.FromRgb(68, 2, 85),
            Color.FromRgb(69, 3, 87),
            Color.FromRgb(69, 5, 88),
            Color.FromRgb(69, 6, 90),
            Color.FromRgb(70, 8, 91),
            Color.FromRgb(70, 9, 93),
            Color.FromRgb(70, 11, 94),
            Color.FromRgb(70, 12, 96),
            Color.FromRgb(71, 14, 97),
            Color.FromRgb(71, 15, 98),
            Color.FromRgb(71, 17, 100),
            Color.FromRgb(71, 18, 101),
            Color.FromRgb(71, 20, 102),
            Color.FromRgb(72, 21, 104),
            Color.FromRgb(72, 22, 105),
            Color.FromRgb(72, 24, 106),
            Color.FromRgb(72, 25, 108),
            Color.FromRgb(72, 26, 109),
            Color.FromRgb(72, 28, 110),
            Color.FromRgb(72, 29, 111),
            Color.FromRgb(72, 30, 112),
            Color.FromRgb(72, 32, 113),
            Color.FromRgb(72, 33, 115),
            Color.FromRgb(72, 34, 116),
            Color.FromRgb(72, 36, 117),
            Color.FromRgb(72, 37, 118),
            Color.FromRgb(72, 38, 119),
            Color.FromRgb(72, 39, 120),
            Color.FromRgb(71, 41, 121),
            Color.FromRgb(71, 42, 121),
            Color.FromRgb(71, 43, 122),
            Color.FromRgb(71, 44, 123),
            Color.FromRgb(71, 46, 124),
            Color.FromRgb(70, 47, 125),
            Color.FromRgb(70, 48, 126),
            Color.FromRgb(70, 49, 126),
            Color.FromRgb(70, 51, 127),
            Color.FromRgb(69, 52, 128),
            Color.FromRgb(69, 53, 129),
            Color.FromRgb(69, 54, 129),
            Color.FromRgb(68, 56, 130),
            Color.FromRgb(68, 57, 131),
            Color.FromRgb(68, 58, 131),
            Color.FromRgb(67, 59, 132),
            Color.FromRgb(67, 60, 132),
            Color.FromRgb(67, 62, 133),
            Color.FromRgb(66, 63, 133),
            Color.FromRgb(66, 64, 134),
            Color.FromRgb(65, 65, 134),
            Color.FromRgb(65, 66, 135),
            Color.FromRgb(65, 67, 135),
            Color.FromRgb(64, 69, 136),
            Color.FromRgb(64, 70, 136),
            Color.FromRgb(63, 71, 136),
            Color.FromRgb(63, 72, 137),
            Color.FromRgb(62, 73, 137),
            Color.FromRgb(62, 74, 137),
            Color.FromRgb(61, 75, 138),
            Color.FromRgb(61, 77, 138),
            Color.FromRgb(60, 78, 138),
            Color.FromRgb(60, 79, 138),
            Color.FromRgb(59, 80, 139),
            Color.FromRgb(59, 81, 139),
            Color.FromRgb(58, 82, 139),
            Color.FromRgb(58, 83, 139),
            Color.FromRgb(57, 84, 140),
            Color.FromRgb(57, 85, 140),
            Color.FromRgb(56, 86, 140),
            Color.FromRgb(56, 87, 140),
            Color.FromRgb(55, 88, 140),
            Color.FromRgb(55, 89, 140),
            Color.FromRgb(54, 91, 141),
            Color.FromRgb(54, 92, 141),
            Color.FromRgb(53, 93, 141),
            Color.FromRgb(53, 94, 141),
            Color.FromRgb(52, 95, 141),
            Color.FromRgb(52, 96, 141),
            Color.FromRgb(51, 97, 141),
            Color.FromRgb(51, 98, 141),
            Color.FromRgb(51, 99, 141),
            Color.FromRgb(50, 100, 142),
            Color.FromRgb(50, 101, 142),
            Color.FromRgb(49, 102, 142),
            Color.FromRgb(49, 103, 142),
            Color.FromRgb(48, 104, 142),
            Color.FromRgb(48, 105, 142),
            Color.FromRgb(47, 106, 142),
            Color.FromRgb(47, 107, 142),
            Color.FromRgb(47, 108, 142),
            Color.FromRgb(46, 109, 142),
            Color.FromRgb(46, 110, 142),
            Color.FromRgb(45, 111, 142),
            Color.FromRgb(45, 112, 142),
            Color.FromRgb(45, 112, 142),
            Color.FromRgb(44, 113, 142),
            Color.FromRgb(44, 114, 142),
            Color.FromRgb(43, 115, 142),
            Color.FromRgb(43, 116, 142),
            Color.FromRgb(43, 117, 142),
            Color.FromRgb(42, 118, 142),
            Color.FromRgb(42, 119, 142),
            Color.FromRgb(41, 120, 142),
            Color.FromRgb(41, 121, 142),
            Color.FromRgb(41, 122, 142),
            Color.FromRgb(40, 123, 142),
            Color.FromRgb(40, 124, 142),
            Color.FromRgb(40, 125, 142),
            Color.FromRgb(39, 126, 142),
            Color.FromRgb(39, 127, 142),
            Color.FromRgb(38, 128, 142),
            Color.FromRgb(38, 129, 142),
            Color.FromRgb(38, 130, 142),
            Color.FromRgb(37, 131, 142),
            Color.FromRgb(37, 131, 142),
            Color.FromRgb(37, 132, 142),
            Color.FromRgb(36, 133, 142),
            Color.FromRgb(36, 134, 142),
            Color.FromRgb(35, 135, 142),
            Color.FromRgb(35, 136, 142),
            Color.FromRgb(35, 137, 142),
            Color.FromRgb(34, 138, 141),
            Color.FromRgb(34, 139, 141),
            Color.FromRgb(34, 140, 141),
            Color.FromRgb(33, 141, 141),
            Color.FromRgb(33, 142, 141),
            Color.FromRgb(33, 143, 141),
            Color.FromRgb(32, 144, 141),
            Color.FromRgb(32, 145, 140),
            Color.FromRgb(32, 146, 140),
            Color.FromRgb(32, 147, 140),
            Color.FromRgb(31, 147, 140),
            Color.FromRgb(31, 148, 140),
            Color.FromRgb(31, 149, 139),
            Color.FromRgb(31, 150, 139),
            Color.FromRgb(31, 151, 139),
            Color.FromRgb(30, 152, 139),
            Color.FromRgb(30, 153, 138),
            Color.FromRgb(30, 154, 138),
            Color.FromRgb(30, 155, 138),
            Color.FromRgb(30, 156, 137),
            Color.FromRgb(30, 157, 137),
            Color.FromRgb(30, 158, 137),
            Color.FromRgb(30, 159, 136),
            Color.FromRgb(30, 160, 136),
            Color.FromRgb(31, 161, 136),
            Color.FromRgb(31, 162, 135),
            Color.FromRgb(31, 163, 135),
            Color.FromRgb(31, 163, 134),
            Color.FromRgb(32, 164, 134),
            Color.FromRgb(32, 165, 134),
            Color.FromRgb(33, 166, 133),
            Color.FromRgb(33, 167, 133),
            Color.FromRgb(34, 168, 132),
            Color.FromRgb(35, 169, 131),
            Color.FromRgb(35, 170, 131),
            Color.FromRgb(36, 171, 130),
            Color.FromRgb(37, 172, 130),
            Color.FromRgb(38, 173, 129),
            Color.FromRgb(39, 174, 129),
            Color.FromRgb(40, 175, 128),
            Color.FromRgb(41, 175, 127),
            Color.FromRgb(42, 176, 127),
            Color.FromRgb(43, 177, 126),
            Color.FromRgb(44, 178, 125),
            Color.FromRgb(46, 179, 124),
            Color.FromRgb(47, 180, 124),
            Color.FromRgb(48, 181, 123),
            Color.FromRgb(50, 182, 122),
            Color.FromRgb(51, 183, 121),
            Color.FromRgb(53, 183, 121),
            Color.FromRgb(54, 184, 120),
            Color.FromRgb(56, 185, 119),
            Color.FromRgb(57, 186, 118),
            Color.FromRgb(59, 187, 117),
            Color.FromRgb(61, 188, 116),
            Color.FromRgb(62, 189, 115),
            Color.FromRgb(64, 190, 114),
            Color.FromRgb(66, 190, 113),
            Color.FromRgb(68, 191, 112),
            Color.FromRgb(70, 192, 111),
            Color.FromRgb(72, 193, 110),
            Color.FromRgb(73, 194, 109),
            Color.FromRgb(75, 194, 108),
            Color.FromRgb(77, 195, 107),
            Color.FromRgb(79, 196, 106),
            Color.FromRgb(81, 197, 105),
            Color.FromRgb(83, 198, 104),
            Color.FromRgb(85, 198, 102),
            Color.FromRgb(88, 199, 101),
            Color.FromRgb(90, 200, 100),
            Color.FromRgb(92, 201, 99),
            Color.FromRgb(94, 201, 98),
            Color.FromRgb(96, 202, 96),
            Color.FromRgb(98, 203, 95),
            Color.FromRgb(101, 204, 94),
            Color.FromRgb(103, 204, 92),
            Color.FromRgb(105, 205, 91),
            Color.FromRgb(108, 206, 90),
            Color.FromRgb(110, 206, 88),
            Color.FromRgb(112, 207, 87),
            Color.FromRgb(115, 208, 85),
            Color.FromRgb(117, 208, 84),
            Color.FromRgb(119, 209, 82),
            Color.FromRgb(122, 210, 81),
            Color.FromRgb(124, 210, 79),
            Color.FromRgb(127, 211, 78),
            Color.FromRgb(129, 212, 76),
            Color.FromRgb(132, 212, 75),
            Color.FromRgb(134, 213, 73),
            Color.FromRgb(137, 213, 72),
            Color.FromRgb(139, 214, 70),
            Color.FromRgb(142, 215, 68),
            Color.FromRgb(144, 215, 67),
            Color.FromRgb(147, 216, 65),
            Color.FromRgb(149, 216, 63),
            Color.FromRgb(152, 217, 62),
            Color.FromRgb(155, 217, 60),
            Color.FromRgb(157, 218, 58),
            Color.FromRgb(160, 218, 57),
            Color.FromRgb(163, 219, 55),
            Color.FromRgb(165, 219, 53),
            Color.FromRgb(168, 220, 51),
            Color.FromRgb(171, 220, 50),
            Color.FromRgb(173, 221, 48),
            Color.FromRgb(176, 221, 46),
            Color.FromRgb(179, 221, 45),
            Color.FromRgb(181, 222, 43),
            Color.FromRgb(184, 222, 41),
            Color.FromRgb(187, 223, 39),
            Color.FromRgb(189, 223, 38),
            Color.FromRgb(192, 223, 36),
            Color.FromRgb(195, 224, 35),
            Color.FromRgb(197, 224, 33),
            Color.FromRgb(200, 225, 32),
            Color.FromRgb(203, 225, 30),
            Color.FromRgb(205, 225, 29),
            Color.FromRgb(208, 226, 28),
            Color.FromRgb(211, 226, 27),
            Color.FromRgb(213, 226, 26),
            Color.FromRgb(216, 227, 25),
            Color.FromRgb(219, 227, 24),
            Color.FromRgb(221, 227, 24),
            Color.FromRgb(224, 228, 24),
            Color.FromRgb(226, 228, 24),
            Color.FromRgb(229, 228, 24),
            Color.FromRgb(232, 229, 25),
            Color.FromRgb(234, 229, 25),
            Color.FromRgb(237, 229, 26),
            Color.FromRgb(239, 230, 27),
            Color.FromRgb(242, 230, 28),
            Color.FromRgb(244, 230, 30),
            Color.FromRgb(247, 230, 31),
            Color.FromRgb(249, 231, 33),
            Color.FromRgb(251, 231, 35),
            Color.FromRgb(254, 231, 36),
        };

        public ColorPaletteViridis(float min, float max)
        {
            this.min = min;
            this.max = max;
        }

        public Color GetColor(float value)
        {
            var idx = GetIndex(value);

            return Colors[idx];
        }

        private int GetIndex(float value)
        {
            var pos = (value - min) / (max - min);
            var idx = (int)(pos * 256);
            if (idx > 255) return 255;
            if (idx < 0) return 0;
            return idx;
        }
    }
}